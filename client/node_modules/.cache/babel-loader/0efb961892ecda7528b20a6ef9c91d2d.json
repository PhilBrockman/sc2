{"ast":null,"code":"var _jsxFileName = \"/Users/philbrockman/coding/sc2/src/components/Attacker.js\";\nimport React from 'react';\nimport { Unit } from \"./Unit\";\nimport { Upgrade } from \"./Upgrade\";\nimport { useSpring, animated } from 'react-spring';\nimport { immortal, marauder, marine } from '../SC2Data';\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst DEFENDER_DEAD = \"defender is dead\";\n\nconst Bonus = ({\n  attack,\n  defender,\n  style\n}) => {\n  return attack.bonuses.map((bonus, index) => {\n    let baseText = /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [\"anti-\", bonus.to]\n    }, void 0, true);\n\n    let bonusText = /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [\"+\", bonus.baseDamage, \" +(\", bonus.researchBonus, \")\"]\n    }, void 0, true);\n\n    let modifier;\n\n    if (!defender) {\n      modifier = /*#__PURE__*/_jsxDEV(\"span\", {\n        children: bonusText\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 17,\n        columnNumber: 18\n      }, this);\n    } else {\n      if (defender.types.includes(bonus.to)) {\n        modifier = /*#__PURE__*/_jsxDEV(\"span\", {\n          className: style,\n          children: [bonusText, \" \\uD83C\\uDFAF\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 20,\n          columnNumber: 20\n        }, this);\n      } else {\n        modifier = /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            textDecoration: \"wavy line-through red\"\n          },\n          children: bonusText\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 22,\n          columnNumber: 19\n        }, this);\n      }\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [baseText, modifier]\n    }, index, true, {\n      fileName: _jsxFileName,\n      lineNumber: 26,\n      columnNumber: 12\n    }, this);\n  });\n};\n\n_c = Bonus;\n\nconst Bullet = ({\n  animate,\n  display\n}) => {\n  if (display) {\n    if (animate) {\n      return /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"bullet\",\n        children: \"\\u27A1\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 38,\n        columnNumber: 14\n      }, this);\n    } else {\n      return /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: \"\\u27A1\"\n      }, void 0, false);\n    }\n  } else {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false);\n  }\n};\n\n_c2 = Bullet;\n\nfunction intersection(a, b) {\n  var setA = new Set(a);\n  var setB = new Set(b);\n  var intersection = new Set([...setA].filter(x => setB.has(x)));\n  return Array.from(intersection);\n}\n\nconst canAttackTargetDefender = (attack, defender) => {\n  if (attack & defender) {\n    return intersection(intersection(attack.targets, defender.types), [\"Ground\", \"Air\"]).length > 0;\n  } else {\n    return;\n  }\n};\n\nconst Attacks = ({\n  unit,\n  defender,\n  defaultIndex,\n  setDefaultIndex,\n  setDamage\n}) => {\n  const toggleIndex = index => {\n    if (index === defaultIndex) {\n      setDefaultIndex(null);\n      setDamage(null);\n    } else {\n      setDefaultIndex(index);\n    }\n  };\n\n  return unit.attacks.map((attack, index) => {\n    const style = index === defaultIndex ? \"main-weapon\" : \"alt-weapon\";\n    const available = canAttackTargetDefender(attack, defender);\n    const cn = available ? \"success\" : \"fail\";\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      onClick: () => toggleIndex(index),\n      className: style,\n      children: /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"attack-name\",\n          children: [/*#__PURE__*/_jsxDEV(Bullet, {\n            animate: defender && defaultIndex === null,\n            display: defaultIndex !== index\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 78,\n            columnNumber: 40\n          }, this), attack.name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 9\n        }, this), index === defaultIndex ? /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [\"Base Damage: \", /*#__PURE__*/_jsxDEV(\"span\", {\n              className: cn,\n              children: [attack.baseDamage, \" + (\", attack.researchBonus, \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 81,\n              columnNumber: 28\n            }, this)]\n          }, void 0, true), /*#__PURE__*/_jsxDEV(Bonus, {\n            attack: attack,\n            defender: defender,\n            style: cn\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 82,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 11\n        }, this) : null]\n      }, void 0, true)\n    }, index, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 12\n    }, this);\n  });\n};\n\n_c3 = Attacks;\nexport const Attacker = ({\n  unit,\n  defender,\n  research,\n  attackChoice,\n  damage,\n  setDamage\n}) => {\n  const [attack, setAttack] = attackChoice;\n  const [attackResearch, setAttackResearch] = research;\n  let damageIndicator;\n\n  if (unit.attacks.length > 0) {\n    if (damage) {\n      damageIndicator = /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: [\"\\u2694\\uFE0F \", damage]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 25\n      }, this);\n    } else {\n      damageIndicator = /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: \"\\u2694\\uFE0F \\uD83D\\uDC40 \"\n      }, void 0, false);\n    }\n  } else {\n    damageIndicator = /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"unit\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(Unit, {\n        unit: unit\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(Attacks, {\n        unit: unit,\n        defaultIndex: attack,\n        setDefaultIndex: setAttack,\n        defender: defender,\n        setDamage: setDamage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"upgrades\",\n      children: /*#__PURE__*/_jsxDEV(Upgrade, {\n        researchKind: \"attack\",\n        updateResearch: setAttackResearch,\n        value: attackResearch\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 7\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 108,\n    columnNumber: 10\n  }, this);\n}; // d = Damage(unit, defender, attack, attackResearch, armorResearch, shieldsResearch)\n// Damage.oneStep(unit, defender)\n\n_c4 = Attacker;\n\nclass Damage {\n  constructor(attacker, defender, attack, research, guardian = 0) {\n    this.oneStep = () => {\n      const [att, def, aidx] = [this.att, this.def, this.attackIndex];\n      const results = [];\n      let log;\n\n      if (att.attacks[aidx] === undefined || !def) {\n        return \"👀\";\n      }\n\n      if (this.def.base.health > 0) {\n        let totalDamage = 0;\n        let damage = this.totalDamage(att, def);\n\n        for (var i = 0; i < att.attacks[aidx].repeats; i++) {\n          var _def$base;\n\n          if (((_def$base = def.base) === null || _def$base === void 0 ? void 0 : _def$base.shields) > 0) {\n            if (damage <= def.base.shields) {\n              def.base.shields -= damage;\n              log = `${damage} to shields. (${def.base.shields} remaining)`;\n            } else {\n              damage -= def.base.shields;\n              def.base.shields = 0;\n              def.base.health -= damage;\n              log = `${damage} has overloaded shields. (${def.base.health} health remaining)`;\n            }\n          } else {\n            def.base.health -= damage;\n            log = `${damage} damage. (${def.base.health} HP)`;\n          }\n\n          totalDamage += damage;\n\n          if (def.base.health < 0) {\n            const overkill = (100 * -def.base.health / totalDamage).toFixed(1);\n            log += ` (${overkill}% attack wasted)`;\n          }\n\n          results.push({\n            health: def.base.health,\n            totalDamage: totalDamage\n          });\n        }\n      }\n\n      return results;\n    };\n\n    const [attackResearch, armorResearch, shieldsResearch] = research;\n    let Spell = 1;\n    let Hallucinated = 1;\n    let Corrupted = 1;\n    let Hardened = 900;\n    let Prismatic = 1;\n\n    const bonusDamage = (att, def) => {\n      return att.attacks[attack].bonuses.filter(bonus => def.types.includes(bonus.to)).reduce((total, amount) => {\n        return total + amount.baseDamage + amount.researchBonus * attackResearch;\n      }, 0);\n    };\n\n    const damageDealt = (att, def) => {\n      return att.attacks[attack].baseDamage + attackResearch * att.attacks[attack].researchBonus + bonusDamage(att, def);\n    };\n\n    const armorDefense = unit => {\n      return unit.base.armor + armorResearch;\n    };\n\n    const defenseAvailable = unit => {\n      var _unit$base;\n\n      if (((_unit$base = unit.base) === null || _unit$base === void 0 ? void 0 : _unit$base.shields) > 0) {\n        return shieldsResearch;\n      } else {\n        return armorDefense(unit);\n      }\n    };\n\n    const defenseApplied = unit => {\n      return defenseAvailable(unit) * Spell * (2 - Hallucinated);\n    };\n\n    const damageReceived = (att, def) => {\n      return damageDealt(att, def) * Corrupted * Hallucinated * Prismatic - defenseApplied(def);\n    };\n\n    const damageCapped = (att, def) => {\n      return Math.min(damageReceived(att, def), Hardened * Corrupted * Hallucinated + 900 * (1 - Spell));\n    };\n\n    const damageInflicted = (att, def) => {\n      return Math.max(.5, damageCapped(att, def) - guardian);\n    };\n\n    this.totalDamage = (att, def) => {\n      if (def.base.shields && damageInflicted(att, def) > def.base.shields + armorDefense(def)) {\n        console.log('def', def);\n        return damageInflicted(att, def) - armorDefense(def);\n      } else {\n        return damageInflicted(att, def);\n      }\n    };\n\n    this.att = JSON.parse(JSON.stringify(attacker));\n    this.def = JSON.parse(JSON.stringify(defender));\n    this.attackIndex = attack;\n  }\n\n}\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"Bonus\");\n$RefreshReg$(_c2, \"Bullet\");\n$RefreshReg$(_c3, \"Attacks\");\n$RefreshReg$(_c4, \"Attacker\");","map":{"version":3,"sources":["/Users/philbrockman/coding/sc2/src/components/Attacker.js"],"names":["React","Unit","Upgrade","useSpring","animated","immortal","marauder","marine","DEFENDER_DEAD","Bonus","attack","defender","style","bonuses","map","bonus","index","baseText","to","bonusText","baseDamage","researchBonus","modifier","types","includes","textDecoration","Bullet","animate","display","intersection","a","b","setA","Set","setB","filter","x","has","Array","from","canAttackTargetDefender","targets","length","Attacks","unit","defaultIndex","setDefaultIndex","setDamage","toggleIndex","attacks","available","cn","name","Attacker","research","attackChoice","damage","setAttack","attackResearch","setAttackResearch","damageIndicator","Damage","constructor","attacker","guardian","oneStep","att","def","aidx","attackIndex","results","log","undefined","base","health","totalDamage","i","repeats","shields","overkill","toFixed","push","armorResearch","shieldsResearch","Spell","Hallucinated","Corrupted","Hardened","Prismatic","bonusDamage","reduce","total","amount","damageDealt","armorDefense","armor","defenseAvailable","defenseApplied","damageReceived","damageCapped","Math","min","damageInflicted","max","console","JSON","parse","stringify"],"mappings":"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","sourcesContent":["import React from 'react'\nimport {Unit} from \"./Unit\"\nimport {Upgrade} from \"./Upgrade\"\nimport { useSpring, animated } from 'react-spring'\nimport { immortal, marauder, marine } from '../SC2Data'\n\nconst DEFENDER_DEAD = \"defender is dead\"\n\nconst Bonus = ({attack, defender, style}) => {\n\n  return attack.bonuses.map((bonus, index) => {\n    let baseText = <>anti-{bonus.to}</>\n    let bonusText = <>+{bonus.baseDamage} +({bonus.researchBonus})</>;\n    let modifier;\n    \n    if(!defender){\n      modifier = <span>{bonusText}</span>\n    } else{\n      if (defender.types.includes(bonus.to) ){\n        modifier=  <span className={style}>{bonusText} 🎯</span>\n      } else {\n        modifier= <span style={{textDecoration: \"wavy line-through red\"}}>{ bonusText}</span>\n      }\n    }\n\n    return <div key={index}>\n      {baseText}\n      {modifier}\n    </div>\n  })\n\n  \n}\n\nconst Bullet = ({animate, display}) => {\n  if(display){\n    if (animate){\n      return <span className={\"bullet\"}>➡</span>\n    } else {\n      return <>➡</>\n    }\n  } else {\n    return <></>\n  }\n}\n\nfunction intersection(a, b) {\n  var setA = new Set(a);\n  var setB = new Set(b);\n  var intersection = new Set([...setA].filter(x => setB.has(x)));\n  return Array.from(intersection);\n}\n\nconst canAttackTargetDefender = (attack, defender) => {\n  if(attack & defender){\n    return intersection(intersection(attack.targets, defender.types), [\"Ground\", \"Air\"]).length > 0\n  } else {\n    return\n  }\n}\n\nconst Attacks = ({unit, defender, defaultIndex, setDefaultIndex, setDamage}) => {\n  const toggleIndex = (index) => {\n      if(index === defaultIndex){\n        setDefaultIndex(null)\n        setDamage(null)\n      } else {\n        setDefaultIndex(index)\n      }\n    }\n  return unit.attacks.map((attack, index) => {\n    const style = index === defaultIndex ? \"main-weapon\" : \"alt-weapon\";\n    const available = canAttackTargetDefender(attack, defender)\n    const cn = available ? \"success\" : \"fail\";\n\n    return <div key={index} onClick={() => toggleIndex(index)} className={style}>\n      <>\n        <div className={\"attack-name\"}><Bullet animate={defender && (defaultIndex === null)} display={(defaultIndex !== index)}/>{attack.name}</div>\n        {index === defaultIndex ?\n          <div>\n            <>Base Damage: <span className={cn}>{attack.baseDamage} + ({attack.researchBonus})</span></>\n            <Bonus attack={attack} defender={defender} style={cn}/>\n          </div>\n          : null\n          }\n      </>\n    </div>\n  })\n}\n\n\n\nexport const Attacker = ({unit, defender, research, attackChoice, damage, setDamage}) => {\n  const [attack, setAttack] = attackChoice;\n  const [attackResearch, setAttackResearch] = research;\n\n  let damageIndicator;\n  if(unit.attacks.length > 0 ){\n    if(damage){\n      damageIndicator = <h1>⚔️ {damage}</h1>;\n    } else {\n      damageIndicator = <>⚔️ 👀 </>;\n    }\n  } else {\n    damageIndicator = <></>;\n  }\n\n  return <div className={\"unit\"}>\n    <div>\n    <Unit unit={unit}>\n    </Unit>\n      <Attacks unit={unit} defaultIndex={attack} setDefaultIndex={setAttack} defender={defender} setDamage={setDamage}/>\n    </div>\n    <div className={\"upgrades\"}>\n      <Upgrade researchKind={\"attack\"} updateResearch={setAttackResearch} value={attackResearch} />\n    </div>\n  </div>\n}\n\n\n\n\n// d = Damage(unit, defender, attack, attackResearch, armorResearch, shieldsResearch)\n// Damage.oneStep(unit, defender)\nclass Damage{\n  constructor( attacker, defender, attack, research, guardian=0) {\n  const [attackResearch, armorResearch, shieldsResearch] = research\n  let Spell = 1\n  let Hallucinated = 1\n  let Corrupted = 1\n  let Hardened = 900\n  let Prismatic = 1\n\n  const bonusDamage = (att, def) => {\n    return att.attacks[attack].bonuses.filter(bonus => def.types.includes(bonus.to)).reduce((total, amount) => {\n      return total+amount.baseDamage+amount.researchBonus*attackResearch\n    }, 0)\n  }\n\n  const damageDealt = (att, def) => {\n    return (\n      att.attacks[attack].baseDamage +\n      attackResearch*att.attacks[attack].researchBonus +\n      bonusDamage(att, def)\n    )\n  }\n\n  const armorDefense = (unit) => {\n    return unit.base.armor + armorResearch\n  }\n\n  const defenseAvailable = (unit) => {\n    if(unit.base?.shields > 0){\n      return shieldsResearch\n    } else {\n      return armorDefense(unit)\n    }\n  }\n\n  const defenseApplied = (unit) => {\n    return defenseAvailable(unit)*Spell*(2-Hallucinated)\n  }\n\n  const damageReceived = (att, def) => {\n    return damageDealt(att, def)*Corrupted*Hallucinated*Prismatic - defenseApplied(def);\n  }\n\n\n  const damageCapped = (att, def) => {\n    return Math.min(\n      damageReceived(att, def),\n      Hardened*Corrupted*Hallucinated+900*(1-Spell)\n    );\n  }\n\n  const damageInflicted = (att, def) => {\n    return Math.max(\n      .5,\n      damageCapped(att, def) - guardian\n    );\n  }\n\n  this.totalDamage = (att, def) => {\n    if(def.base.shields && damageInflicted(att, def) > def.base.shields + armorDefense(def)){\n      console.log('def', def)\n      return damageInflicted(att, def)-armorDefense(def)\n    } else {\n      return damageInflicted(att, def)\n    }\n  }\n\n\n  this.att = JSON.parse(JSON.stringify(attacker));\n  this.def = JSON.parse(JSON.stringify(defender));\n  this.attackIndex = attack\n}\n\noneStep = () => {\n  const [att, def, aidx] = [this.att, this.def, this.attackIndex]\n  const results = []\n  let log;\n\n  if(att.attacks[aidx] === undefined || !def){\n    return \"👀\"\n  }\n  if(this.def.base.health > 0){\n    let totalDamage=0;\n\n    let damage = this.totalDamage(att, def);\n    for(var i = 0; i < att.attacks[aidx].repeats; i++){\n      if(def.base?.shields > 0){\n        if(damage <= def.base.shields){\n          def.base.shields -= damage\n          log = `${damage} to shields. (${def.base.shields} remaining)`\n        } else {\n          damage -= def.base.shields;\n          def.base.shields = 0;\n          def.base.health -= damage;\n          log = `${damage} has overloaded shields. (${def.base.health} health remaining)`\n        }\n      } else {\n        def.base.health -= damage;\n        log = `${damage} damage. (${def.base.health} HP)`\n      }\n      totalDamage += damage;\n      if(def.base.health < 0){\n        const overkill = (100*-def.base.health/totalDamage).toFixed(1)\n        log += ` (${overkill}% attack wasted)`\n      }\n      results.push({health: def.base.health, totalDamage: totalDamage})\n    }\n  }\n  return results\n}\n}\n"]},"metadata":{},"sourceType":"module"}