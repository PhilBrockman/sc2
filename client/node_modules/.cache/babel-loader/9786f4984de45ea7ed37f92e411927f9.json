{"ast":null,"code":"var _jsxFileName = \"/Users/philbrockman/coding/sc2/src/components/Attacker.js\";\nimport React from 'react';\nimport { Unit } from \"./Unit\";\nimport { Upgrade } from \"./Upgrade\";\nimport { useSpring, animated } from 'react-spring';\nimport { immortal, marauder, marine } from '../SC2Data';\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst DEFENDER_DEAD = \"defender is dead\";\n\nconst Bonus = ({\n  attack,\n  defender,\n  textstyle\n}) => {\n  return attack.bonuses.map((bonus, index) => {\n    let baseText = /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [\"Anti-\", bonus.to, \":\"]\n    }, void 0, true);\n\n    let bonusText = /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [bonus.baseDamage, \" (+\", bonus.researchBonus, \")\"]\n    }, void 0, true);\n\n    let modifier;\n\n    if (!defender) {\n      modifier = /*#__PURE__*/_jsxDEV(\"span\", {\n        children: bonusText\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 18,\n        columnNumber: 18\n      }, this);\n    } else {\n      const overlap = intersection(intersection(attack.targets, defender.types), [\"Ground\", \"Air\"]);\n\n      if (overlap.length === 0) {\n        modifier = /*#__PURE__*/_jsxDEV(\"span\", {\n          children: [\" \", bonusText, \" \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 22,\n          columnNumber: 20\n        }, this);\n      } else {\n        if (defender.types.includes(bonus.to)) {\n          modifier = /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [bonusText, \" \\uD83C\\uDFAF\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 25,\n            columnNumber: 22\n          }, this);\n        } else {\n          modifier = /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              textDecoration: \"wavy line-through red\"\n            },\n            children: bonusText\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 27,\n            columnNumber: 21\n          }, this);\n        }\n      }\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [baseText, /*#__PURE__*/_jsxDEV(\"span\", {\n        className: textstyle,\n        children: modifier\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 34,\n        columnNumber: 7\n      }, this)]\n    }, index, true, {\n      fileName: _jsxFileName,\n      lineNumber: 32,\n      columnNumber: 12\n    }, this);\n  });\n};\n\n_c = Bonus;\n\nconst Bullet = ({\n  animate,\n  display\n}) => {\n  if (display) {\n    if (animate) {\n      return /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"bullet\",\n        children: \"\\u27A1\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 46,\n        columnNumber: 14\n      }, this);\n    } else {\n      return /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: \"\\u27A1\"\n      }, void 0, false);\n    }\n  } else {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false);\n  }\n};\n\n_c2 = Bullet;\n\nfunction intersection(a, b) {\n  var setA = new Set(a);\n  var setB = new Set(b);\n  var intersection = new Set([...setA].filter(x => setB.has(x)));\n  return Array.from(intersection);\n}\n\nexport const canAttackTargetDefender = (attack, defender) => {\n  if (attack && defender) {\n    console.log('defender', defender);\n    const overlap = intersection(intersection(attack.targets, defender.types), [\"Ground\", \"Air\"]);\n    console.log('overlap', overlap);\n    return overlap.length > 0;\n  } else {\n    return false;\n  }\n};\n\nconst Attacks = ({\n  unit,\n  defender,\n  defaultIndex,\n  setDefaultIndex\n}) => {\n  const toggleIndex = index => {\n    if (index === defaultIndex) {\n      setDefaultIndex(null);\n    } else {\n      setDefaultIndex(index);\n    }\n  };\n\n  return unit.attacks.map((attack, index) => {\n    const cns = [];\n    cns.push(index === defaultIndex ? \"main-weapon\" : \"alt-weapon\");\n    const available = canAttackTargetDefender(attack, defender);\n    cns.push(available ? \"attack-available\" : \"attack-unavailable\");\n    const cn = available ? \"success\" : \"fail\";\n    console.log('available', available);\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      onClick: () => toggleIndex(index),\n      className: cns.join(\" \"),\n      children: /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"attack-name\",\n          children: [/*#__PURE__*/_jsxDEV(Bullet, {\n            animate: available && defaultIndex === null,\n            display: defaultIndex !== index\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 92,\n            columnNumber: 40\n          }, this), attack.name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 9\n        }, this), index === defaultIndex ? /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [\"Base Damage: \", /*#__PURE__*/_jsxDEV(\"span\", {\n              className: cn,\n              children: [attack.baseDamage, \" + (\", attack.researchBonus, \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 95,\n              columnNumber: 28\n            }, this)]\n          }, void 0, true), /*#__PURE__*/_jsxDEV(Bonus, {\n            attack: attack,\n            defender: defender,\n            textstyle: cn\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 96,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 11\n        }, this) : null]\n      }, void 0, true)\n    }, index, false, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 12\n    }, this);\n  });\n};\n\n_c3 = Attacks;\nexport const Attacker = ({\n  unit,\n  defender,\n  research,\n  attackChoice\n}) => {\n  const [attack, setAttack] = attackChoice; // let damageIndicator;\n  // if(unit.attacks.length > 0 ){\n  //   if(damage){\n  //     damageIndicator = <h1>⚔️ {damage}</h1>;\n  //   } else {\n  //     damageIndicator = <>⚔️ 👀 </>;\n  //   }\n  // } else {\n  //   damageIndicator = <></>;\n  // }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"unit\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(Unit, {\n        unit: unit\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(Attacks, {\n        unit: unit,\n        defaultIndex: attack,\n        setDefaultIndex: setAttack,\n        defender: defender\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 5\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 121,\n    columnNumber: 10\n  }, this);\n}; // d = Damage(unit, defender, attack, attackResearch, armorResearch, shieldsResearch)\n// Damage.oneStep(unit, defender)\n\n_c4 = Attacker;\nexport class Damage {\n  constructor(attacker, _defender, attackIndex, research, guardian = 0) {\n    this.totalDamage = () => {\n      const def = this.def;\n      const att = this.att;\n\n      if (def.base.shields && this.damageInflicted(att, def) > def.base.shields + this.armorDefense(def)) {\n        return this.damageInflicted(att, def) - this.armorDefense(def);\n      } else {\n        return this.damageInflicted(att, def);\n      }\n    };\n\n    this.eliminate = () => {\n      var _newValues;\n\n      let newValues = this.oneShot()[0];\n      let count = 0;\n\n      if (((_newValues = newValues) === null || _newValues === void 0 ? void 0 : _newValues.health) > 0) {\n        count++;\n        const defender = { ...this.def,\n          base: { ...this.def.base,\n            health: newValues.health,\n            shields: newValues.shields\n          }\n        };\n        const d = new Damage(this.att, JSON.parse(JSON.stringify(defender)), this.attackIndex, [this.research.attack, this.research.shields, this.research.armor]);\n        newValues = d.oneShot();\n      }\n\n      return count;\n    };\n\n    this.oneShot = (faked = true) => {\n      let att;\n      let def;\n\n      if (faked) {\n        att = JSON.parse(JSON.stringify(this.att));\n        def = JSON.parse(JSON.stringify(this.def));\n      } else {\n        att = this.att;\n        def = this.def;\n      }\n\n      const results = [];\n      let log;\n\n      if (att.attacks[this.attackIndex] === undefined || !def) {\n        return \"👀\";\n      }\n\n      if (!canAttackTargetDefender(att.attacks[this.attackIndex], def)) {\n        return \"can't shoot\";\n      }\n\n      if (def.base.health > 0) {\n        let totalDamage = 0;\n        let damage = this.totalDamage();\n\n        for (var i = 0; i < att.attacks[this.attackIndex].repeats; i++) {\n          var _def$base;\n\n          if (((_def$base = def.base) === null || _def$base === void 0 ? void 0 : _def$base.shields) > 0) {\n            if (damage <= def.base.shields) {\n              def.base.shields -= damage;\n              log = `${damage} to shields. (${def.base.shields} remaining)`;\n            } else {\n              damage -= def.base.shields;\n              def.base.shields = 0;\n              def.base.health -= damage;\n              log = `${damage} has overloaded shields. (${def.base.health} health remaining)`;\n            }\n          } else {\n            def.base.health -= damage;\n            log = `${damage} damage. (${def.base.health} HP)`;\n          }\n\n          totalDamage += damage;\n\n          if (def.base.health < 0) {\n            const overkill = (100 * -def.base.health / totalDamage).toFixed(1);\n            log += ` (${overkill}% attack wasted)`;\n          }\n\n          results.push({\n            health: def.base.health,\n            shields: def.base.shields,\n            totalDamage: totalDamage\n          });\n        }\n      }\n\n      if (!faked) {\n        this.att = JSON.parse(JSON.stringify(this.att));\n        this.def = JSON.parse(JSON.stringify(this.def));\n      }\n\n      return results;\n    };\n\n    const [attackResearch, shieldsResearch, armorResearch] = research;\n    this.research = {\n      attack: attackResearch,\n      armor: armorResearch,\n      shields: shieldsResearch\n    };\n    this.att = JSON.parse(JSON.stringify(attacker));\n    this.def = JSON.parse(JSON.stringify(_defender));\n    this.attackIndex = attackIndex;\n    let Spell = 1;\n    let Hallucinated = 1;\n    let Corrupted = 1;\n    let Hardened = 900;\n    let Prismatic = 1;\n\n    this.bonusDamage = () => {\n      return this.att.attacks[this.attackIndex].bonuses.filter(bonus => this.def.types.includes(bonus.to)).reduce((total, amount) => {\n        return total + amount.baseDamage + amount.researchBonus * this.research.attack;\n      }, 0);\n    };\n\n    this.damageDealt = () => {\n      var _this$att;\n\n      const attack = (_this$att = this.att) === null || _this$att === void 0 ? void 0 : _this$att.attacks[this.attackIndex];\n\n      if (this.att && this.def && attack) {\n        return attack.baseDamage + this.research.attack * attack.researchBonus + this.bonusDamage();\n      } else {\n        return \"not enough info\";\n      }\n    };\n\n    this.armorDefense = () => {\n      return this.def.base.armor + this.research.armor;\n    };\n\n    this.defenseAvailable = () => {\n      var _this$def$base;\n\n      if (((_this$def$base = this.def.base) === null || _this$def$base === void 0 ? void 0 : _this$def$base.shields) > 0) {\n        console.log(\"have shield\", this.def.name);\n        return this.research.shields;\n      } else {\n        console.log('no shields', this.def.name);\n        return this.armorDefense(this.def);\n      }\n    };\n\n    this.defenseApplied = () => {\n      return this.defenseAvailable() * Spell * (2 - Hallucinated);\n    };\n\n    this.damageReceived = () => {\n      return this.damageDealt() * Corrupted * Hallucinated * Prismatic - this.defenseApplied();\n    };\n\n    this.damageCapped = (att, def) => {\n      return Math.min(this.damageReceived(att, def), Hardened * Corrupted * Hallucinated + 900 * (1 - Spell));\n    };\n\n    this.damageInflicted = (att, def) => {\n      return Math.max(.5, this.damageCapped(att, def) - guardian);\n    };\n  }\n\n}\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"Bonus\");\n$RefreshReg$(_c2, \"Bullet\");\n$RefreshReg$(_c3, \"Attacks\");\n$RefreshReg$(_c4, \"Attacker\");","map":{"version":3,"sources":["/Users/philbrockman/coding/sc2/src/components/Attacker.js"],"names":["React","Unit","Upgrade","useSpring","animated","immortal","marauder","marine","DEFENDER_DEAD","Bonus","attack","defender","textstyle","bonuses","map","bonus","index","baseText","to","bonusText","baseDamage","researchBonus","modifier","overlap","intersection","targets","types","length","includes","textDecoration","Bullet","animate","display","a","b","setA","Set","setB","filter","x","has","Array","from","canAttackTargetDefender","console","log","Attacks","unit","defaultIndex","setDefaultIndex","toggleIndex","attacks","cns","push","available","cn","join","name","Attacker","research","attackChoice","setAttack","Damage","constructor","attacker","attackIndex","guardian","totalDamage","def","att","base","shields","damageInflicted","armorDefense","eliminate","newValues","oneShot","count","health","d","JSON","parse","stringify","armor","faked","results","undefined","damage","i","repeats","overkill","toFixed","attackResearch","shieldsResearch","armorResearch","Spell","Hallucinated","Corrupted","Hardened","Prismatic","bonusDamage","reduce","total","amount","damageDealt","defenseAvailable","defenseApplied","damageReceived","damageCapped","Math","min","max"],"mappings":"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","sourcesContent":["import React from 'react'\nimport {Unit} from \"./Unit\"\nimport {Upgrade} from \"./Upgrade\"\nimport { useSpring, animated } from 'react-spring'\nimport { immortal, marauder, marine } from '../SC2Data'\n\n\nconst DEFENDER_DEAD = \"defender is dead\"\n\nconst Bonus = ({attack, defender, textstyle}) => {\n\n  return attack.bonuses.map((bonus, index) => {\n    let baseText = <>Anti-{bonus.to}:</>\n    let bonusText = <>{bonus.baseDamage} (+{bonus.researchBonus})</>;\n    let modifier;\n    \n    if(!defender){\n      modifier = <span>{bonusText}</span>\n    } else {\n      const overlap = intersection(intersection(attack.targets, defender.types), [\"Ground\", \"Air\"]);\n      if (overlap.length === 0){\n        modifier = <span> {bonusText} </span>\n      }else{\n        if (defender.types.includes(bonus.to) ){\n          modifier=  <span>{bonusText} 🎯</span>\n        } else {\n          modifier= <span style={{textDecoration: \"wavy line-through red\"}}>{ bonusText}</span>\n        }\n      }\n    }\n\n    return <div key={index}>\n      {baseText}\n      <span className={textstyle}>\n      {modifier}\n      </span>\n    </div>\n  })\n\n  \n}\n\nconst Bullet = ({animate, display}) => {\n  if(display){\n    if (animate){\n      return <span className={\"bullet\"}>➡</span>\n    } else {\n      return <>➡</>\n    }\n  } else {\n    return <></>\n  }\n}\n\nfunction intersection(a, b) {\n  var setA = new Set(a);\n  var setB = new Set(b);\n  var intersection = new Set([...setA].filter(x => setB.has(x)));\n  return Array.from(intersection);\n}\n\nexport const canAttackTargetDefender = (attack, defender) => {\n\n  if(attack && defender){\n    console.log('defender', defender)\n    const overlap = intersection(intersection(attack.targets, defender.types), [\"Ground\", \"Air\"]);\n    console.log('overlap', overlap)\n    return overlap.length > 0\n  } else {\n    return false\n  }\n}\n\nconst Attacks = ({unit, defender, defaultIndex, setDefaultIndex}) => {\n  const toggleIndex = (index) => {\n      if(index === defaultIndex){\n        setDefaultIndex(null)\n      } else {\n        setDefaultIndex(index)\n      }\n    }\n  return unit.attacks.map((attack, index) => {\n    const cns = []\n    cns.push(index === defaultIndex ? \"main-weapon\" : \"alt-weapon\");\n    const available = canAttackTargetDefender(attack, defender);\n    cns.push(available ? \"attack-available\" : \"attack-unavailable\");\n    const cn = available ? \"success\" : \"fail\";\n    console.log('available', available)\n\n    return <div key={index} onClick={() => toggleIndex(index)} className={cns.join(\" \")}>\n      <>\n        <div className={\"attack-name\"}><Bullet animate={available && (defaultIndex === null)} display={(defaultIndex !== index)}/>{attack.name}</div>\n        {index === defaultIndex ?\n          <div>\n            <>Base Damage: <span className={cn}>{attack.baseDamage} + ({attack.researchBonus})</span></>\n            <Bonus attack={attack} defender={defender} textstyle={cn}/>\n          </div>\n          : null\n          }\n      </>\n    </div>\n  })\n}\n\n\n\nexport const Attacker = ({unit, defender, research, attackChoice}) => {\n  const [attack, setAttack] = attackChoice;\n\n  // let damageIndicator;\n  // if(unit.attacks.length > 0 ){\n  //   if(damage){\n  //     damageIndicator = <h1>⚔️ {damage}</h1>;\n  //   } else {\n  //     damageIndicator = <>⚔️ 👀 </>;\n  //   }\n  // } else {\n  //   damageIndicator = <></>;\n  // }\n\n  return <div className={\"unit\"}>\n    <div>\n    <Unit unit={unit}>\n    </Unit>\n      <Attacks unit={unit} defaultIndex={attack} setDefaultIndex={setAttack} defender={defender} />\n    </div>\n  </div>\n}\n\n\n\n\n// d = Damage(unit, defender, attack, attackResearch, armorResearch, shieldsResearch)\n// Damage.oneStep(unit, defender)\nexport class Damage{\n  constructor( attacker, defender, attackIndex, research, guardian=0) {\n  const [attackResearch, shieldsResearch, armorResearch] = research\n  this.research = {\n    attack: attackResearch,\n    armor: armorResearch,\n    shields: shieldsResearch\n  }\n\n  this.att = JSON.parse(JSON.stringify(attacker));\n  this.def = JSON.parse(JSON.stringify(defender));\n  this.attackIndex = attackIndex\n\n  let Spell = 1\n  let Hallucinated = 1\n  let Corrupted = 1\n  let Hardened = 900\n  let Prismatic = 1\n\n  this.bonusDamage = () => {\n    return this.att.attacks[this.attackIndex].bonuses.filter(bonus => this.def.types.includes(bonus.to)).reduce((total, amount) => {\n      return total+amount.baseDamage+amount.researchBonus*this.research.attack\n    }, 0)\n  }\n\n  this.damageDealt = () => {\n    const attack = this.att?.attacks[this.attackIndex]\n    if(this.att && this.def && attack){\n      return (\n        attack.baseDamage +\n        this.research.attack*attack.researchBonus +\n        this.bonusDamage()\n      )  \n    } else {\n      return \"not enough info\"\n    }\n  }\n\n  this.armorDefense = () => {\n    return this.def.base.armor + this.research.armor\n  }\n\n  this.defenseAvailable = () => {\n    if(this.def.base?.shields > 0){\n\n      console.log(\"have shield\", this.def.name)\n      return this.research.shields\n    } else {\n      console.log('no shields', this.def.name)\n      return this.armorDefense(this.def)\n    }\n  }\n\n  this.defenseApplied = () => {\n    return this.defenseAvailable()*Spell*(2-Hallucinated)\n  }\n\nthis.damageReceived = () => {\n    return this.damageDealt()*Corrupted*Hallucinated*Prismatic - this.defenseApplied();\n  }\n\n\n  this.damageCapped = (att, def) => {\n    return Math.min(\n      this.damageReceived(att, def),\n      Hardened*Corrupted*Hallucinated+900*(1-Spell)\n    );\n  }\n\n  this.damageInflicted = (att, def) => {\n    return Math.max(\n      .5,\n      this.damageCapped(att, def) - guardian\n    );\n  }\n\n\n}\n\ntotalDamage = () => {\n  const def = this.def\n  const att = this.att\n\n  if(def.base.shields && this.damageInflicted(att, def) > def.base.shields + this.armorDefense(def)){\n    return this.damageInflicted(att, def)-this.armorDefense(def)\n  } else {\n    return this.damageInflicted(att, def)\n  }\n}\n\n\neliminate = () => {\n  let newValues = this.oneShot()[0];\n  let count = 0\n  if(newValues?.health > 0){\n    count++;\n    const defender = {\n        ...this.def,\n        base: {\n          ...this.def.base,\n          health: newValues.health,\n          shields: newValues.shields,\n        }\n      }\n      const d =  new Damage(this.att,\n        JSON.parse(JSON.stringify(defender)), this.attackIndex, \n        [ this.research.attack, this.research.shields, this.research.armor])\n      newValues= d.oneShot()\n    }\n    return count;\n}\n\n\noneShot = (faked=true) => {\n  let att; let def;\n  if(faked){\n    att = JSON.parse(JSON.stringify(this.att));\n    def = JSON.parse(JSON.stringify(this.def));\n  } else {\n    att = this.att\n    def = this.def\n  }\n\n  const results = []\n  let log;\n\n  if(att.attacks[this.attackIndex] === undefined || !def){\n    return \"👀\"\n  } if(\n    !canAttackTargetDefender(att.attacks[this.attackIndex], def)\n  ){\n    return \"can't shoot\"\n  }\n  if(def.base.health > 0){\n    let totalDamage=0;\n\n    let damage = this.totalDamage();\n    for(var i = 0; i < att.attacks[this.attackIndex].repeats; i++){\n      if(def.base?.shields > 0){\n        if(damage <= def.base.shields){\n          def.base.shields -= damage\n          log = `${damage} to shields. (${def.base.shields} remaining)`\n        } else {\n          damage -= def.base.shields;\n          def.base.shields = 0;\n          def.base.health -= damage;\n          log = `${damage} has overloaded shields. (${def.base.health} health remaining)`\n        }\n      } else {\n        def.base.health -= damage;\n        log = `${damage} damage. (${def.base.health} HP)`\n      }\n      totalDamage += damage;\n      if(def.base.health < 0){\n        const overkill = (100*-def.base.health/totalDamage).toFixed(1)\n        log += ` (${overkill}% attack wasted)`\n      }\n      results.push({health: def.base.health, shields: def.base.shields, totalDamage: totalDamage})\n    }\n  }\n\n  if(!faked){\n    this.att = JSON.parse(JSON.stringify(this.att));\n    this.def = JSON.parse(JSON.stringify(this.def));\n  } \n  return results\n}\n}\n"]},"metadata":{},"sourceType":"module"}